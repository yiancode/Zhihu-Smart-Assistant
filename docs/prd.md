## 产品需求文档（PRD）

### 1. 目标和背景

**目标：**
- 提升知乎用户的浏览体验，通过智能化工具提高信息获取效率
- 去除干扰元素，让用户专注于高质量内容
- 利用AI技术帮助用户快速理解和总结长篇内容
- 提供个性化的视觉体验，保护用户视力健康

**背景：**
知乎作为中文互联网最大的问答社区，内容质量参差不齐，广告和推荐内容日益增多。用户需要花费大量时间筛选高质量回答，长篇内容阅读负担重。本插件旨在通过技术手段解决这些痛点，让知乎回归纯粹的知识分享平台体验。

**变更日志：**
| 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|
| 2024-01-XX | 1.0 | 初始PRD | John (PM) |

### 2. 需求

#### 功能需求

**FR1:** 插件应支持一键切换至少3种预设主题（默认、暗黑、护眼）
**FR2:** 插件应自动识别并过滤知乎页面中的广告内容，包括信息流广告、侧边栏推广和软文推荐
**FR3:** 在问答页面，插件应自动提取第一页所有回答并按赞同数排序显示在侧边栏
**FR4:** 侧边栏应支持展开/折叠，且可通过拖拽调整宽度（240px-480px）
**FR5:** 用户应能一键复制单个回答的完整内容到剪贴板
**FR6:** 插件应能调用AI API对选中的回答进行智能总结，生成不超过200字的核心观点
**FR7:** 用户应能在设置页面配置AI服务的API密钥和模型选择
**FR8:** 插件应记住用户的所有设置偏好，并在不同设备间同步（通过Chrome账号）
**FR9:** 插件应支持快捷键操作（Alt+Z显示/隐藏侧边栏，Alt+C复制，Alt+S总结）
**FR10:** 插件应在用户首次安装时显示引导教程

#### 非功能需求

**NFR1:** 插件体积应小于5MB，确保快速安装和加载
**NFR2:** 页面加载性能影响应小于100ms
**NFR3:** 所有UI操作响应时间应小于300ms
**NFR4:** AI总结响应时间应小于3秒（不含网络延迟）
**NFR5:** 插件应兼容Chrome 100+版本，遵循Manifest V3规范
**NFR6:** 用户数据和API密钥应使用加密存储
**NFR7:** 插件应支持中文和英文界面

### 3. 用户界面设计目标

**整体UX愿景：**
创建一个无干扰、高效率、视觉舒适的知乎浏览环境，让用户专注于知识本身。

**关键交互范式：**
- 最小化干预：默认自动运行，无需频繁操作
- 快速访问：所有功能通过快捷键或单击即可触达
- 渐进式呈现：高级功能隐藏在设置中，不打扰普通用户

**核心界面：**
- Popup弹窗：快速设置面板
- 侧边栏：回答聚合和AI总结展示
- 设置页面：详细配置中心
- 注入样式：主题美化效果

**无障碍要求：** WCAG AA标准

**目标设备和平台：** 桌面版Chrome浏览器（Windows、Mac、Linux）

### 4. 技术假设

**仓库结构：** 单仓库（Monorepo）

**服务架构：** Chrome扩展客户端 + 外部AI API服务

**测试要求：** 
- 单元测试覆盖率 >70%
- 集成测试覆盖核心功能流程
- 手动测试覆盖不同知乎页面类型

**额外技术假设：**
- 使用chrome-extension-boilerplate-react-vite作为基础框架
- 采用React 18 + TypeScript + Vite构建
- 使用Tailwind CSS实现样式和主题系统
- 集成OpenAI API作为默认AI服务提供商

### 5. Epic列表

**Epic 1: 基础设施与核心功能** - 建立项目基础，实现主题切换和广告过滤
**Epic 2: 内容聚合与交互** - 实现回答提取、侧边栏和复制功能  
**Epic 3: AI智能增强** - 集成AI总结功能和相关配置

### 6. Epic详细说明

## Epic 1: 基础设施与核心功能

**目标：** 搭建插件基础架构，实现主题美化和广告过滤两大核心功能，确保插件能够稳定运行在知乎网站上。

### Story 1.1: 项目初始化与开发环境搭建

**用户故事：**
作为开发者，
我需要基于chrome-extension-boilerplate-react-vite搭建项目，
以便开始插件开发工作。

**验收标准：**
1. 成功克隆并配置boilerplate项目
2. 安装所有必要依赖（React、Vite、TypeScript、Tailwind等）
3. 配置Manifest V3文件，包含正确的权限和host_permissions
4. 实现基础的popup、content script和background worker
5. 开发服务器能够正常启动，支持HMR
6. 能够在Chrome中加载未打包的扩展

### Story 1.2: 主题系统实现

**用户故事：**
作为知乎用户，
我希望能够一键切换不同的视觉主题，
以便在不同环境下舒适地浏览内容。

**验收标准：**
1. 实现三种预设主题的CSS变量定义
2. 创建主题切换UI组件（在popup中）
3. 实现主题注入逻辑（content script）
4. 主题设置能够持久化存储
5. 主题切换即时生效，无需刷新页面
6. 覆盖知乎原生样式，确保主题完整性

### Story 1.3: 广告过滤器实现

**用户故事：**
作为知乎用户，
我希望自动过滤页面中的广告内容，
以便专注于有价值的问答内容。

**验收标准：**
1. 识别并隐藏信息流中的推广内容
2. 移除侧边栏广告模块
3. 过滤"相关推荐"中的营销内容
4. 保持页面布局不因移除广告而错乱
5. 提供开关控制是否启用广告过滤
6. 过滤规则可通过DOM选择器配置

### Story 1.4: Popup界面开发

**用户故事：**
作为用户，
我希望通过点击扩展图标快速访问主要功能，
以便快速切换设置。

**验收标准：**
1. 实现320x400px的Popup界面
2. 包含主题切换单选按钮组
3. 包含功能开关（广告过滤、侧边栏、AI总结）
4. 添加设置和统计入口按钮
5. 界面响应迅速，交互流畅
6. 视觉样式与整体设计保持一致

## Epic 2: 内容聚合与交互

**目标：** 实现高赞回答的智能提取和聚合展示，提供便捷的内容操作功能，显著提升用户获取优质内容的效率。

### Story 2.1: 回答内容提取器

**用户故事：**
作为用户，
我希望自动提取问题页面的所有回答，
以便快速浏览高质量内容。

**验收标准：**
1. 准确识别知乎问答页面URL模式
2. 提取页面中所有回答的DOM元素
3. 解析回答的关键信息（作者、赞同数、内容、发布时间）
4. 按赞同数降序排序
5. 处理动态加载的内容（监听DOM变化）
6. 支持不同版本的知乎页面结构

### Story 2.2: 侧边栏容器实现

**用户故事：**
作为用户，
我希望在页面右侧有一个可折叠的侧边栏，
以便查看聚合的高赞回答。

**验收标准：**
1. 创建固定定位的侧边栏容器（默认360px宽）
2. 实现平滑的展开/折叠动画（300ms）
3. 支持拖拽调整宽度（240px-480px范围）
4. 响应式处理：窗口<1200px时收起为浮动按钮
5. 保存用户的宽度偏好设置
6. 不遮挡原始页面的重要内容

### Story 2.3: 回答卡片组件

**用户故事：**
作为用户，
我希望在侧边栏中以卡片形式查看每个回答的摘要，
以便快速了解答案要点。

**验收标准：**
1. 显示作者头像和昵称
2. 显示赞同数（格式化大数字如2.5k）
3. 显示前3行内容预览
4. 实现展开/收起完整内容
5. 添加复制按钮和跳转到原回答按钮
6. 支持虚拟滚动（当回答数>20时）

### Story 2.4: 复制功能实现

**用户故事：**
作为用户，
我希望一键复制回答内容，
以便分享或保存有价值的内容。

**验收标准：**
1. 点击复制按钮将纯文本内容复制到剪贴板
2. 保留基础格式（段落、列表）
3. 显示复制成功的Toast提示
4. 支持快捷键Alt+C复制当前选中回答
5. 处理复制失败的情况并给出提示

## Epic 3: AI智能增强

**目标：** 集成AI大模型能力，为用户提供智能内容总结功能，帮助快速理解长篇回答的核心观点。

### Story 3.1: AI服务集成

**用户故事：**
作为用户，
我希望配置AI服务，
以便使用智能总结功能。

**验收标准：**
1. 在设置页面添加AI配置标签
2. 提供API密钥输入框（密码类型）
3. 提供模型选择下拉菜单（GPT-3.5/GPT-4等）
4. API密钥加密存储在chrome.storage中
5. 提供测试连接按钮验证配置
6. 支持自定义API端点（兼容其他服务）

### Story 3.2: 内容总结功能

**用户故事：**
作为用户，
我希望AI能够总结长篇回答，
以便快速获取核心观点。

**验收标准：**
1. 在回答卡片添加"AI总结"按钮
2. 构建合适的总结prompt模板
3. 调用AI API生成200字以内的总结
4. 在侧边栏顶部显示总结结果
5. 提供重新生成和复制总结功能
6. 显示加载状态和错误处理

### Story 3.3: 批量总结与智能分析

**用户故事：**
作为用户，
我希望AI能够综合分析多个高赞回答，
以便全面了解问题的不同观点。

**验收标准：**
1. 添加"综合分析"按钮
2. 提取前5个高赞回答发送给AI
3. 生成观点对比和共识总结
4. 支持选择特定回答进行分析
5. 结果可导出为Markdown格式
6. 处理API调用限流和错误

### Story 3.4: 设置页面完善

**用户故事：**
作为用户，
我希望有完整的设置界面，
以便自定义插件的各项功能。

**验收标准：**
1. 实现标签式设置页面布局
2. 主题设置：预览和自定义颜色
3. 过滤设置：规则管理和白名单
4. AI设置：API配置和prompt模板
5. 快捷键设置：自定义键位绑定
6. 导入/导出配置功能
